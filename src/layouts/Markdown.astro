---
import Html from "./Html.astro"
import Header from "../components/Header.astro"
import Wrapper from "../components/Wrapper.astro"
import type { CollectionEntry } from "astro:content"
import PageHeader from "../components/PageHeader.astro"
import { format, formatISO } from "date-fns"
import Footer from "../components/Footer.astro"
import FlexSpacer from "../components/FlexSpacer.astro"
import { defaultOpenGraph } from "../meta"
import "/node_modules/katex/dist/katex.css"

export interface Props {
  entry: CollectionEntry<"blog">
}

const { entry } = Astro.props
const og = defaultOpenGraph
og.title = entry.data.title
og.type = "article"
---

<Html meta={{ title: entry.data.title, og }}>
  <Header />
  <main>
    <Wrapper element="article" className={entry.data.style}>
      <PageHeader title={entry.data.title}>
        {
          entry.data.subtitle && (
            <div class="subtitle">{entry.data.subtitle}</div>
          )
        }
        <time datetime={formatISO(entry.data.date)}
          >{format(entry.data.date, "MMM dd yyyy")}</time
        >
      </PageHeader>
      <slot />
    </Wrapper>
  </main>
  <FlexSpacer />
  <Footer />
</Html>

<style is:global lang="scss">
  .subtitle {
    font-style: italic;
  }

  article.serif {
    p {
      font-family: var(--font-serif);
    }

    h2,
    h3,
    h4,
    h5,
    h6 {
      font-family: var(--font-serif);
    }

    h3 {
      font-style: normal;
      font-variant: small-caps;
      font-weight: 700;
      font-size: 1em;
    }
  }

  article {
    .astro-code {
      grid-column: wide;
      margin: 0 -1rem;
      border-top: 1px solid;
      border-bottom: 1px solid;
      border-color: var(--neutral-10);
      padding: 1rem;
      font-size: 0.9em;

      &::-webkit-scrollbar {
        background-color: transparent;
        height: 8px;
      }

      &::-webkit-scrollbar-thumb {
        opacity: 0.1;
        background-color: #ffffff;
        height: 8px;
      }

      &::-webkit-scrollbar-track {
        padding: 1px;
      }
    }

    code:not(.astro-code > *) {
      background-color: var(--neutral-10);
      padding: 0 0.2em;
      font-size: 0.9em;
    }

    a {
      color: var(--neutral-60);
      text-decoration: underline;
    }

    ul,
    ol {
      margin: 0;
    }

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    time {
      color: var(--neutral-60);
    }

    h2,
    h3,
    h4,
    h5,
    h6 {
      margin: 0.75rem 0 -0.25rem 0;
      font-style: italic;
      font-weight: 400;
    }

    h2 {
      font-size: 1.3em;
    }

    h3 {
      font-size: 1.1em;
    }

    h4,
    h5,
    h6 {
      font-size: 1em;
    }

    hr {
      border-top: none;
      border-bottom: 1px solid var(--neutral-60);
      width: 20%;
    }

    blockquote {
      margin: 0;
      border-left: 1px solid var(--neutral-60);
      padding: 0 0 0 2rem;
    }

    .footnotes {
      display: flex;
      flex-direction: column;
      gap: 1.25rem 0;
      color: var(--neutral-60);
    }

    section.footnotes {
      #footnote-label {
        font-size: 1em;
      }

      a[data-footnote-backref] {
        font-family: var(--font-mono);

        text-decoration: none;
      }
    }

    a[data-footnote-ref] {
      color: inherit;
      text-decoration: none;
    }

    .katex {
      font-size: 1.125em;
    }

    .katex-display {
      margin: 0;
      padding: 1px 0 0;
      overflow: auto hidden;
    }
  }
</style>
