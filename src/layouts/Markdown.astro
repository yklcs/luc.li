---
import Html from "./Html.astro"
import Header from "../components/Header.astro"
import Wrapper from "../components/Wrapper.astro"
import type { CollectionEntry } from "astro:content"
import PageHeader from "../components/PageHeader.astro"
import { format, formatISO } from "date-fns"
import Footer from "../components/Footer.astro"
import FlexSpacer from "../components/FlexSpacer.astro"
import { defaultOpenGraph } from "../meta"
import "/node_modules/katex/dist/katex.css"

export interface Props {
  entry?: CollectionEntry<"blog">
  frontmatter?: any
}

const frontmatter = Astro.props.entry
  ? Astro.props.entry.data
  : Astro.props.frontmatter || Astro.props

const og = defaultOpenGraph
og.title = frontmatter.title
og.type = "article"
---

<Html meta={{ title: frontmatter.title, og }}>
  <Header />
  <main>
    <Wrapper element="article" className={frontmatter.style}>
      <PageHeader title={frontmatter.title} className="article-header">
        {
          frontmatter.subtitle && (
            <div class="subtitle">{frontmatter.subtitle}</div>
          )
        }{
          frontmatter.time && (
            <time datetime={formatISO(frontmatter.date)}>
              {format(frontmatter.date, "MMM d yyyy")}
            </time>
          )
        }
      </PageHeader>
      <slot />
    </Wrapper>
  </main>
  <FlexSpacer />
  <Footer />
</Html>

<style is:global lang="scss">
  .subtitle {
    font-style: italic;
  }

  article.serif {
    & > * {
      font-family: var(--font-serif);
    }

    .article-header {
      font-family: var(--font-sans);
    }

    h3 {
      font-style: normal;
      font-variant: small-caps;
      font-weight: 700;
      font-size: 1em;
      font-feature-settings: "c2sc";
    }
  }

  article {
    p {
      max-width: var(--w-main);
    }

    .astro-code {
      grid-column: wide;
      margin: 0 -1rem;
      border-top: 1px solid;
      border-bottom: 1px solid;
      border-color: var(--neutral-10);
      padding: 1rem;
      font-size: 0.9em;

      &::-webkit-scrollbar {
        background-color: transparent;
        height: 8px;
      }

      &::-webkit-scrollbar-thumb {
        opacity: 0.1;
        background-color: #ffffff;
        height: 8px;
      }

      &::-webkit-scrollbar-track {
        padding: 1px;
      }
    }

    code:not(.astro-code > *) {
      background-color: var(--neutral-10);
      padding: 0 0.2em;
      font-size: 0.9em;
    }

    a {
      text-decoration: underline;
      text-decoration-color: var(--neutral-60);
      text-decoration-thickness: 1px;
    }

    ul,
    ol {
      margin: 0;
    }

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    time {
      color: var(--neutral-60);
    }

    h2,
    h3,
    h4,
    h5,
    h6 {
      margin: 1.5rem 0 -0.25rem 0;
      font-style: italic;
      font-weight: 400;
    }

    h2 {
      font-size: 1.3em;
    }

    h3 {
      font-size: 1.1em;
    }

    h4,
    h5,
    h6 {
      font-size: 1em;
    }

    hr {
      display: inline-block;
      border: none;
      color: var(--neutral-60);
      &::after {
        content: "‚ÅÇ";
      }
    }

    blockquote {
      margin: 0;
      border-left: 1px solid var(--neutral-60);
      padding: 0 0 0 2rem;
    }

    section.footnotes {
      display: flex;
      flex-direction: column;
      order: 100;
      gap: 1.25rem 0;
      color: var(--neutral-60);

      a[data-footnote-backref] {
        font-family: var(--font-mono);
        text-decoration: none;
      }
    }

    a[data-footnote-ref] {
      color: inherit;
      text-decoration: none;
    }

    .katex {
      font-size: 1.125em;
    }

    .katex-display {
      margin: 0;
      padding: 1px 0 0;
      overflow: auto hidden;
    }
  }
</style>
